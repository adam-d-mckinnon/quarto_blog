{
  "hash": "5c705860c9bc60822d29dcad704365a2",
  "result": {
    "markdown": "---\ntitle: 'A People Analytics Tutorial on Unsupervised Machine Learning'\ndate: 2020-08-04\ndescription: 'A \"How To\" article on the use of Cluster Analysis to understand phenomenon within Organisations.'\nauthor: \n    - name: Adam D McKinnon\n    - name: Monica Ashton\ncategories: [Cluster Analysis, Gowers Distance, TSNE, Plotly, R]\nimage: \"sphx_glr_plot_cluster_comparison_0011.png\"\ntitle-block-banner: true\n---\n\n::: {.cell}\n::: {.cell-output-display}\n![Image source: Clustering: scikit-learn.org](sphx_glr_plot_cluster_comparison_0011.png){width=100%}\n:::\n:::\n\n\n<br>\n\n\nWe recently published an article titled [**\"A Beginner's Guide to Machine Learning for HR Practitioners\"**](https://www.adam-d-mckinnon.com/posts/welcome/) where we touched on the three broad types of Machine Learning (ML); reinforcement, supervised, and unsupervised learning. In this follow-up article we will explore unsupervised ML in more depth. We will demonstrate how we use cluster analysis, a form of unsupervised ML, to identify similarities, patterns, and relationships in datasets intelligently (like humans – but faster or more accurately). We have included some practical code written in R. Let’s get started!\n\n<br>\n\n## Cluster Analysis in HR\nThe objective we aim to achieve is an understanding of factors associated with employee turnover within our data. To do this, we form clusters based on a set of employee variables (i.e., Features) such as age, marital status, role level, and so on. The clusters help us better understand the many attributes that may be associated with turnover, and whether there are distinct clusters of employees that are more susceptible to turnover. This last insight can facilitate the personalising of the employee experience at scale by determining whether current HR policies are serving the employee clusters identified in the analysis, as opposed to using a one size fits all approach.\n\n\n# 1. Importing the Data\nWe begin by loading the R packages we will need for the analysis. The dataset we have used for our example is publicly available – it’s the IBM Attrition dataset. You can download it [**here**](https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset/) if you would like to follow along.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # data workhorse\nlibrary(readxl) # importing xlsx files\nlibrary(correlationfunnel) # rapid exploratory data analysis\nlibrary(cluster) # calculating gower distance and PAM\nlibrary(Rtsne) # dimensionality reduction and visualization\nlibrary(plotly) # interactive graphing\nlibrary(DT) # interactive tables\n\n\nset.seed(175) # reproducibility\n\nhr_data_tbl <- readxl::read_xlsx(\"datasets_1067_1925_WA_Fn-UseC_-HR-Employee-Attrition.xlsx\")\n```\n:::\n\n\n<br>\n\n# 2. Selecting Variables for Clustering\nUnder normal circumstances, we would spend time exploring the data – examining variables and their data types, visualising descriptive analyses (e.g., single variable and two variable analyses), understanding distributions, performing transformations if needed, and treating missing values and outliers. \n\nHowever, for the sake of simplicity, we will skip this and instead just calculate the correlation between attrition and each variable in the dataset. Those variables with a correlation of greater than 0.1 will be included in the analysis. This is useful for several reasons, but most importantly to decide which variables to include for our cluster analysis.\n\nKeep in mind that when it comes to clustering (or any other method), including more variables does not always mean a better outcome—simplicity should be the goal. Including more variables can complicate the interpretation of results and consequently make it difficult for the end-users to act upon results.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhr_corr_tbl <- hr_data_tbl %>%\n    \n  # remove the Employee Number variable from the correlation analysis\n    dplyr::select(-EmployeeNumber) %>%\n    \n    # binarize cotinuous variables and one hot encode factors\n    correlationfunnel::binarize(n_bins        = 5, \n                                thresh_infreq = 0.01, \n                                name_infreq   = \"OTHER\", \n                                one_hot       = TRUE) %>%\n    \n    # correlate all variables with Attrition\n    correlationfunnel::correlate(Attrition__Yes)\n\n\nhr_corr_tbl %>%\n    # plot the correlation\n    correlationfunnel::plot_correlation_funnel(interactive = TRUE)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-43318226aedc21a8593b\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-43318226aedc21a8593b\">{\"x\":{\"data\":[{\"x\":[0,0],\"y\":[0.4,31.6],\"text\":\"\",\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(255,0,0,1)\",\"dash\":\"dash\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[-1,1,-0.246117994245804,0.246117994245804,0.212551096797114,0.206261967491481,0.2051670685142,0.195342355161261,0.181573471236258,0.180364429404994,0.17541855360922,0.171171876975466,0.162610954704957,0.157234270114793,-0.151048571597372,-0.131138275292419,0.122818651806023,0.117161039928458,0.115142765545051,-0.108122903184442,-0.103481737833152,0.0986887943026597,-0.098649567948639,0.0982904854596026,-0.097434760716718,-0.0943440389422919,-0.0909836512072824,0.0903288582110223,-0.0888698417497812,-0.0878299567498919,-0.0877163458893424,-0.0864610440446073,-0.0852929275767967,-0.0836007899569045,-0.0833163841644976,-0.0831777551898719,-0.082993924081346,0.0808552021360538,-0.080472149582789,-0.0786960496461546,-0.0783441875873579,-0.0758452077771366,-0.0744572992808522,0.0693545947648202,-0.0643011305604017,-0.0635774903465706,-0.0626369478467936,0.061894406973909,-0.060024751648164,0.0592223765690819,-0.0584763799533202,0.0570832087056188,-0.0562130512842715,0.0557806657217636,-0.0555380534550301,0.0536470485565395,0.0536466103789503,-0.0535658407499408,-0.0495378383669475,-0.0491678010313982,-0.0480969610294037,-0.0479087192018828,-0.0476379651833623,-0.0469987158780699,-0.0466072322109866,0.0447314705452419,-0.0442091673690162,-0.0435127935264003,0.0412161419443025,-0.0404384279136688,-0.0403092973241783,-0.0398543359853736,-0.0395298537691888,-0.0388475454468261,-0.0377643150135814,0.0375443985857368,0.0366045810269936,0.0364661968371013,0.0362150820698559,0.0353348808456097,-0.0351697315413425,-0.0342228376555373,0.0341433722163271,0.0339596077572285,-0.0327031477228971,0.0323037041693942,-0.0306301835838467,0.0305230714225062,0.0299161187041835,-0.0294532531751417,0.0294532531751417,0.0294303484836082,-0.0285067457541877,0.0280652856704796,-0.0260439246616237,0.0258983636312174,0.025723436587807,-0.0256756279940707,-0.0249734220729596,-0.0238618019046667,-0.0238453239468233,-0.0229398766875514,-0.0211128418677835,0.0207769633830653,0.0197743684592596,-0.01975071637301,0.0193949837648285,-0.017897516831939,-0.0176108655433134,0.0168320096044974,-0.0166236017683018,-0.0163802115322648,-0.015724006490382,-0.015724006490382,-0.0152674232371252,0.0141310089325874,-0.0135912641685966,0.0120242402573509,0.0120242402573509,-0.011983848101205,0.0110927061171171,-0.0106895392482966,0.0102708152947105,0.00739953246606211,-0.00704650026203013,0.00701451173601698,-0.00688425919277378,0.00403796302117428,0.0028887517110808,-0.0028887517110808,0.0028887517110808,0.0023246955959006,0.00161072398409206,-0.000833725574031576,-0.000359571340436571],\"y\":[31,31,30,30,29,28,27,26,25,24,23,22,21,20,26,29,19,18,17,21,25,16,24,20,27,28,23,15,20,15,23,29,14,22,20,22,20,14,26,20,13,28,17,12,16,18,21,11,24,10,24,13,18,12,9,9,8,29,17,27,28,19,22,12,7,18,19,25,11,27,11,11,27,8,21,11,7,12,20,9,11,8,21,6,12,7,6,5,4,3,3,22,2,24,25,5,2,2,5,25,4,10,11,2,20,7,13,12,10,14,9,29,5,5,19,16,4,8,28,10,16,6,26,8,9,15,2,15,6,1,1,13,6,7,20],\"text\":[\"Attrition<br />Bin: No<br />Correlation: -1\",\"Attrition<br />Bin: Yes<br />Correlation: 1\",\"OverTime<br />Bin: No<br />Correlation: -0.246\",\"OverTime<br />Bin: Yes<br />Correlation: 0.246\",\"JobLevel<br />Bin: 1<br />Correlation: 0.213\",\"MonthlyIncome<br />Bin: -Inf_2695.8<br />Correlation: 0.206\",\"YearsAtCompany<br />Bin: -Inf_2<br />Correlation: 0.205\",\"StockOptionLevel<br />Bin: 0<br />Correlation: 0.195\",\"YearsWithCurrManager<br />Bin: -Inf_1<br />Correlation: 0.182\",\"TotalWorkingYears<br />Bin: -Inf_5<br />Correlation: 0.18\",\"MaritalStatus<br />Bin: Single<br />Correlation: 0.175\",\"Age<br />Bin: -Inf_29<br />Correlation: 0.171\",\"YearsInCurrentRole<br />Bin: -Inf_1<br />Correlation: 0.163\",\"JobRole<br />Bin: Sales_Representative<br />Correlation: 0.157\",\"StockOptionLevel<br />Bin: 1<br />Correlation: -0.151\",\"JobLevel<br />Bin: 2<br />Correlation: -0.131\",\"EnvironmentSatisfaction<br />Bin: 1<br />Correlation: 0.123\",\"JobInvolvement<br />Bin: 1<br />Correlation: 0.117\",\"BusinessTravel<br />Bin: Travel_Frequently<br />Correlation: 0.115\",\"YearsInCurrentRole<br />Bin: 7_Inf<br />Correlation: -0.108\",\"YearsWithCurrManager<br />Bin: 7_Inf<br />Correlation: -0.103\",\"WorkLifeBalance<br />Bin: 1<br />Correlation: 0.099\",\"TotalWorkingYears<br />Bin: 17_Inf<br />Correlation: -0.099\",\"JobRole<br />Bin: Laboratory_Technician<br />Correlation: 0.098\",\"YearsAtCompany<br />Bin: 10_Inf<br />Correlation: -0.097\",\"MonthlyIncome<br />Bin: 9860_Inf<br />Correlation: -0.094\",\"MaritalStatus<br />Bin: Married<br />Correlation: -0.091\",\"JobSatisfaction<br />Bin: 1<br />Correlation: 0.09\",\"JobRole<br />Bin: Research_Director<br />Correlation: -0.089\",\"JobSatisfaction<br />Bin: 4<br />Correlation: -0.088\",\"MaritalStatus<br />Bin: Divorced<br />Correlation: -0.088\",\"JobLevel<br />Bin: 4<br />Correlation: -0.086\",\"Department<br />Bin: Research_&_Development<br />Correlation: -0.085\",\"Age<br />Bin: 34_38<br />Correlation: -0.084\",\"JobRole<br />Bin: Manager<br />Correlation: -0.083\",\"Age<br />Bin: 38_45<br />Correlation: -0.083\",\"JobRole<br />Bin: Manufacturing_Director<br />Correlation: -0.083\",\"Department<br />Bin: Sales<br />Correlation: 0.081\",\"StockOptionLevel<br />Bin: 2<br />Correlation: -0.08\",\"JobRole<br />Bin: Healthcare_Representative<br />Correlation: -0.079\",\"NumCompaniesWorked<br />Bin: 1_3<br />Correlation: -0.078\",\"MonthlyIncome<br />Bin: 4228.8_5743.4<br />Correlation: -0.076\",\"BusinessTravel<br />Bin: Non-Travel<br />Correlation: -0.074\",\"EducationField<br />Bin: Technical_Degree<br />Correlation: 0.069\",\"WorkLifeBalance<br />Bin: 3<br />Correlation: -0.064\",\"JobInvolvement<br />Bin: 4<br />Correlation: -0.064\",\"YearsInCurrentRole<br />Bin: 4_7<br />Correlation: -0.063\",\"TrainingTimesLastYear<br />Bin: 0<br />Correlation: 0.062\",\"TotalWorkingYears<br />Bin: 8_10<br />Correlation: -0.06\",\"RelationshipSatisfaction<br />Bin: 1<br />Correlation: 0.059\",\"TotalWorkingYears<br />Bin: 10_17<br />Correlation: -0.058\",\"NumCompaniesWorked<br />Bin: 5_Inf<br />Correlation: 0.057\",\"JobInvolvement<br />Bin: 3<br />Correlation: -0.056\",\"EducationField<br />Bin: Marketing<br />Correlation: 0.056\",\"DistanceFromHome<br />Bin: -Inf_2<br />Correlation: -0.056\",\"DistanceFromHome<br />Bin: 17_Inf<br />Correlation: 0.054\",\"DailyRate<br />Bin: -Inf_391.8<br />Correlation: 0.054\",\"JobLevel<br />Bin: 5<br />Correlation: -0.054\",\"BusinessTravel<br />Bin: Travel_Rarely<br />Correlation: -0.05\",\"YearsAtCompany<br />Bin: 7_10<br />Correlation: -0.049\",\"MonthlyIncome<br />Bin: 5743.4_9860<br />Correlation: -0.048\",\"EnvironmentSatisfaction<br />Bin: 4<br />Correlation: -0.048\",\"Age<br />Bin: 45_Inf<br />Correlation: -0.048\",\"EducationField<br />Bin: Medical<br />Correlation: -0.047\",\"HourlyRate<br />Bin: 73_87<br />Correlation: -0.047\",\"JobInvolvement<br />Bin: 2<br />Correlation: 0.045\",\"EnvironmentSatisfaction<br />Bin: 3<br />Correlation: -0.044\",\"YearsWithCurrManager<br />Bin: 2_4<br />Correlation: -0.044\",\"TrainingTimesLastYear<br />Bin: 4<br />Correlation: 0.041\",\"YearsAtCompany<br />Bin: 2_5<br />Correlation: -0.04\",\"TrainingTimesLastYear<br />Bin: 6<br />Correlation: -0.04\",\"TrainingTimesLastYear<br />Bin: 3<br />Correlation: -0.04\",\"YearsAtCompany<br />Bin: 5_7<br />Correlation: -0.04\",\"DailyRate<br />Bin: 942.4_1224.2<br />Correlation: -0.039\",\"YearsInCurrentRole<br />Bin: 2_4<br />Correlation: -0.038\",\"TrainingTimesLastYear<br />Bin: 2<br />Correlation: 0.038\",\"HourlyRate<br />Bin: 45_59<br />Correlation: 0.037\",\"EducationField<br />Bin: Human_Resources<br />Correlation: 0.036\",\"JobRole<br />Bin: Human_Resources<br />Correlation: 0.036\",\"DistanceFromHome<br />Bin: 9_17<br />Correlation: 0.035\",\"TrainingTimesLastYear<br />Bin: 5<br />Correlation: -0.035\",\"DailyRate<br />Bin: 1224.2_Inf<br />Correlation: -0.034\",\"YearsInCurrentRole<br />Bin: 1_2<br />Correlation: 0.034\",\"PercentSalaryHike<br />Bin: -Inf_12<br />Correlation: 0.034\",\"EducationField<br />Bin: Life_Sciences<br />Correlation: -0.033\",\"HourlyRate<br />Bin: 59_73<br />Correlation: 0.032\",\"PercentSalaryHike<br />Bin: 13_15<br />Correlation: -0.031\",\"MonthlyRate<br />Bin: 6887.4_11773<br />Correlation: 0.031\",\"YearsSinceLastPromotion<br />Bin: -Inf_1<br />Correlation: 0.03\",\"Gender<br />Bin: Female<br />Correlation: -0.029\",\"Gender<br />Bin: Male<br />Correlation: 0.029\",\"Age<br />Bin: 29_34<br />Correlation: 0.029\",\"Education<br />Bin: 5<br />Correlation: -0.029\",\"TotalWorkingYears<br />Bin: 5_8<br />Correlation: 0.028\",\"YearsWithCurrManager<br />Bin: 4_7<br />Correlation: -0.026\",\"MonthlyRate<br />Bin: 21712_Inf<br />Correlation: 0.026\",\"Education<br />Bin: 3<br />Correlation: 0.026\",\"Education<br />Bin: 4<br />Correlation: -0.026\",\"MonthlyRate<br />Bin: 11773_16714.2<br />Correlation: -0.025\",\"YearsWithCurrManager<br />Bin: 1_2<br />Correlation: -0.024\",\"YearsSinceLastPromotion<br />Bin: 4_Inf<br />Correlation: -0.024\",\"RelationshipSatisfaction<br />Bin: 4<br />Correlation: -0.023\",\"TrainingTimesLastYear<br />Bin: 1<br />Correlation: -0.021\",\"Education<br />Bin: 1<br />Correlation: 0.021\",\"JobRole<br />Bin: Sales_Executive<br />Correlation: 0.02\",\"HourlyRate<br />Bin: -Inf_45<br />Correlation: -0.02\",\"NumCompaniesWorked<br />Bin: -Inf_1<br />Correlation: 0.019\",\"EducationField<br />Bin: Other<br />Correlation: -0.018\",\"RelationshipSatisfaction<br />Bin: 2<br />Correlation: -0.018\",\"Department<br />Bin: Human_Resources<br />Correlation: 0.017\",\"DistanceFromHome<br />Bin: 5_9<br />Correlation: -0.017\",\"JobLevel<br />Bin: 3<br />Correlation: -0.016\",\"MonthlyRate<br />Bin: -Inf_6887.4<br />Correlation: -0.016\",\"MonthlyRate<br />Bin: 16714.2_21712<br />Correlation: -0.016\",\"EnvironmentSatisfaction<br />Bin: 2<br />Correlation: -0.015\",\"WorkLifeBalance<br />Bin: 4<br />Correlation: 0.014\",\"YearsSinceLastPromotion<br />Bin: 1_4<br />Correlation: -0.014\",\"DailyRate<br />Bin: 391.8_656.2<br />Correlation: 0.012\",\"MonthlyIncome<br />Bin: 2695.8_4228.8<br />Correlation: 0.012\",\"RelationshipSatisfaction<br />Bin: 3<br />Correlation: -0.012\",\"WorkLifeBalance<br />Bin: 2<br />Correlation: 0.011\",\"PercentSalaryHike<br />Bin: 15_19<br />Correlation: -0.011\",\"StockOptionLevel<br />Bin: 3<br />Correlation: 0.01\",\"DailyRate<br />Bin: 656.2_942.4<br />Correlation: 0.007\",\"DistanceFromHome<br />Bin: 2_5<br />Correlation: -0.007\",\"JobSatisfaction<br />Bin: 3<br />Correlation: 0.007\",\"Education<br />Bin: 2<br />Correlation: -0.007\",\"JobSatisfaction<br />Bin: 2<br />Correlation: 0.004\",\"PercentSalaryHike<br />Bin: 19_Inf<br />Correlation: 0.003\",\"PerformanceRating<br />Bin: 3<br />Correlation: -0.003\",\"PerformanceRating<br />Bin: 4<br />Correlation: 0.003\",\"NumCompaniesWorked<br />Bin: 3_5<br />Correlation: 0.002\",\"PercentSalaryHike<br />Bin: 12_13<br />Correlation: 0.002\",\"HourlyRate<br />Bin: 87_Inf<br />Correlation: -0.001\",\"JobRole<br />Bin: Research_Scientist<br />Correlation: 0\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(44,62,80,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(44,62,80,1)\"}},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":165.844748858448},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Correlation Funnel\",\"font\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-1.1,1.1],\"tickmode\":\"array\",\"ticktext\":[\"-1.0\",\"-0.5\",\"0.0\",\"0.5\",\"1.0\"],\"tickvals\":[-1,-0.5,0,0.5,1],\"categoryorder\":\"array\",\"categoryarray\":[\"-1.0\",\"-0.5\",\"0.0\",\"0.5\",\"1.0\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(204,204,204,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.22139200221392,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(204,204,204,1)\",\"gridwidth\":0.22139200221392,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"correlation\",\"font\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.4,31.6],\"tickmode\":\"array\",\"ticktext\":[\"PerformanceRating\",\"Education\",\"Gender\",\"YearsSinceLastPromotion\",\"MonthlyRate\",\"PercentSalaryHike\",\"HourlyRate\",\"DailyRate\",\"DistanceFromHome\",\"RelationshipSatisfaction\",\"TrainingTimesLastYear\",\"EducationField\",\"NumCompaniesWorked\",\"Department\",\"JobSatisfaction\",\"WorkLifeBalance\",\"BusinessTravel\",\"JobInvolvement\",\"EnvironmentSatisfaction\",\"JobRole\",\"YearsInCurrentRole\",\"Age\",\"MaritalStatus\",\"TotalWorkingYears\",\"YearsWithCurrManager\",\"StockOptionLevel\",\"YearsAtCompany\",\"MonthlyIncome\",\"JobLevel\",\"OverTime\",\"Attrition\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],\"categoryorder\":\"array\",\"categoryarray\":[\"PerformanceRating\",\"Education\",\"Gender\",\"YearsSinceLastPromotion\",\"MonthlyRate\",\"PercentSalaryHike\",\"HourlyRate\",\"DailyRate\",\"DistanceFromHome\",\"RelationshipSatisfaction\",\"TrainingTimesLastYear\",\"EducationField\",\"NumCompaniesWorked\",\"Department\",\"JobSatisfaction\",\"WorkLifeBalance\",\"BusinessTravel\",\"JobInvolvement\",\"EnvironmentSatisfaction\",\"JobRole\",\"YearsInCurrentRole\",\"Age\",\"MaritalStatus\",\"TotalWorkingYears\",\"YearsWithCurrManager\",\"StockOptionLevel\",\"YearsAtCompany\",\"MonthlyIncome\",\"JobLevel\",\"OverTime\",\"Attrition\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(204,204,204,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.22139200221392,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(204,204,204,1)\",\"gridwidth\":0.22139200221392,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"feature\",\"font\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(44,62,80,1)\",\"width\":0.33208800332088,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(44,62,80,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"363246d0de5\":{\"xintercept\":{},\"type\":\"scatter\"},\"363213ab37a8\":{\"x\":{},\"y\":{},\"text\":{}}},\"cur_data\":\"363246d0de5\",\"visdat\":{\"363246d0de5\":[\"function (y) \",\"x\"],\"363213ab37a8\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n<br>\n\nBy using our correlation value of 0.1 as a cutoff, the analysis suggests the inclusion of fifteen variables for clustering: from overtime to business travel. In preparation for the analysis, any of these fifteen variables which are of a character data type (e.g. MaritalStatus = Single) are converted to a factor datatype (more on this below).\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select the variables we wish to include in the analysis\nvar_selection <- c(\"EmployeeNumber\", \"Attrition\", \"OverTime\", \n                   \"JobLevel\", \"MonthlyIncome\", \"YearsAtCompany\", \n                   \"StockOptionLevel\", \"YearsWithCurrManager\", \n                   \"TotalWorkingYears\", \"MaritalStatus\", \"Age\", \n                   \"YearsInCurrentRole\", \"JobRole\", \"EnvironmentSatisfaction\",\n                   \"JobInvolvement\", \"BusinessTravel\")\n\n\nhr_subset_tbl <- hr_data_tbl %>%\n\n    # select our variables listed above\n    dplyr::select(one_of(var_selection)) %>%\n  \n    # convert the character variables to factors\n    dplyr::mutate_if(is.character, as_factor) %>%\n  \n    # recorder the variables\n    dplyr::select(EmployeeNumber, Attrition, everything())\n```\n:::\n\n\n<br>\n\n# 3. Analysis: Gower Distance\nIn essence, clustering is all about determining how similar (or dissimilar) cases in a dataset are to one another so that we can then group them together. To do this we first need to give each case (i.e., employee) a score based on the fifteen variables selected and then determine the difference between employees based on this score. \n\nThe most common way of performing this activity is by calculating the “Euclidean Distance”. However, Euclidean Distance is effective when analysing continuous variables (e.g., age, salary, tenure), and thus is not suitable for our HR dataset, which includes ordinal (e.g., EnvironmentSatisfaction – values from 1 = worst to 5 = best) and nominal data types (MaritalStatus – 1 = Single, 2 = Divorced, etc.). Therefore, we have to use a distance metric that can handle different data types; the Gower Distance.\n\nThe main advantage of Gower Distance is that it is simple to calculate and intuitive to understand. However, the disadvantage of this method is that it requires a distance matrix, a data structure that compares each case to every other case in the dataset, which needs considerable computing power and memory for large datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute Gower distance and covert to a matrix\ngower_dist <- cluster::daisy(hr_subset_tbl[, 2:16], metric = \"gower\")\ngower_mat <- base::as.matrix(gower_dist)\n```\n:::\n\n\n\nWe can perform a sanity check on our distance matrix by determining the most similar and/or dissimilar pair of employees. Here we calculate the two most similar employees according to their Gower Distance score.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Print most similar employees \nsimilar_tbl <- hr_subset_tbl[which(gower_mat == min(gower_mat[gower_mat != min(gower_mat)]), \n                                   arr.ind = TRUE)[1, ], ]\n\n\n# Transform the results to a datatable and save as a png file \nsimilar_employees <- similar_tbl %>%\n\n    # convert to a datatable\n    DT::datatable(rownames = FALSE, caption = 'Table of two most similar employees',\n                options = list(\n                                columnDefs = list(list(className = 'dt-center', \n                                                       targets   = 0:15)),\n                                dom            = 't',\n                                scrollX        = TRUE,\n                                scrollCollapse = TRUE)) \n\n\nsimilar_employees\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-669563c90b49e3b2029f\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-669563c90b49e3b2029f\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"caption\":\"<caption>Table of two most similar employees<\\/caption>\",\"data\":[[1624,614],[\"Yes\",\"Yes\"],[\"Yes\",\"Yes\"],[1,1],[1569,1878],[0,0],[0,0],[0,0],[0,0],[\"Single\",\"Single\"],[18,18],[0,0],[\"Sales Representative\",\"Sales Representative\"],[2,2],[3,3],[\"Travel_Frequently\",\"Travel_Frequently\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>EmployeeNumber<\\/th>\\n      <th>Attrition<\\/th>\\n      <th>OverTime<\\/th>\\n      <th>JobLevel<\\/th>\\n      <th>MonthlyIncome<\\/th>\\n      <th>YearsAtCompany<\\/th>\\n      <th>StockOptionLevel<\\/th>\\n      <th>YearsWithCurrManager<\\/th>\\n      <th>TotalWorkingYears<\\/th>\\n      <th>MaritalStatus<\\/th>\\n      <th>Age<\\/th>\\n      <th>YearsInCurrentRole<\\/th>\\n      <th>JobRole<\\/th>\\n      <th>EnvironmentSatisfaction<\\/th>\\n      <th>JobInvolvement<\\/th>\\n      <th>BusinessTravel<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-center\",\"targets\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]}],\"dom\":\"t\",\"scrollX\":true,\"scrollCollapse\":true,\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n<br>\n\nWe learn from our sanity check in the table above that EmployeeID 1624 and EmployeeID 614, let’s call them Bob and Fred, are considered to be the most similar in the dataset. Looking at the table we can see that their values for fourteen of the fifteen variables are identical – only monthly salary differs slightly. The Gower Distance seems to be working and the output makes sense, now let’s perform the cluster analysis to see if we can understand turnover.\n\n<br>\n\n# 4. Analysis: How many Clusters?\nThe one big question that must be answered when performing cluster analysis is “how many clusters should we segment the dataset into?” \n\nWe can use a data-driven approach to determine the optimal number of clusters by calculating the silhouette width. With this metric, we measure how similar each observation (i.e., in our case one employee) is to its assigned cluster, and conversely how dissimilar it is to neighbouring clusters. The metric can range from -1 to 1, where values of 1 show a clear cluster assignment, 0 suggests weak cluster assignment (i.e., a case could have been assigned to one of two neighbouring clusters) and -1 wrong cluster assignment.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the cluster analysis multiple times with different numbers of clusters\nsil_width <- purrr::map_dbl(2:10, function(k){\n  model <- cluster::pam(gower_dist, k = k)\n  model$silinfo$avg.width\n})\n\n\n# create a tibble with each row representing the cluster number \n# and average silhouette width\nsil_tbl <- tibble::tibble(\n  k = 2:10,\n  sil_width = sil_width\n)\n\n\n# visualize the clusters numbers and average silhouette width to \n# identify the optimal number of clusters\nfig2 <- ggplot2::ggplot(sil_tbl, aes(x = k, y = sil_width)) +\n  geom_point(size = 2) +\n  geom_line() +\n  scale_x_continuous(breaks = 2:10)\n\n\nplotly::ggplotly(fig2)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-a96af68c8a2df7d476da\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a96af68c8a2df7d476da\">{\"x\":{\"data\":[{\"x\":[2,3,4,5,6,7,8,9,10],\"y\":[0.128925990605184,0.128556845639092,0.121152291482427,0.119881619475743,0.143552339250341,0.123045329075571,0.12897038257169,0.127843144864784,0.124663465942131],\"text\":[\"k:  2<br />sil_width: 0.1289260\",\"k:  3<br />sil_width: 0.1285568\",\"k:  4<br />sil_width: 0.1211523\",\"k:  5<br />sil_width: 0.1198816\",\"k:  6<br />sil_width: 0.1435523\",\"k:  7<br />sil_width: 0.1230453\",\"k:  8<br />sil_width: 0.1289704\",\"k:  9<br />sil_width: 0.1278431\",\"k: 10<br />sil_width: 0.1246635\"],\"type\":\"scatter\",\"mode\":\"markers+lines\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,0,0,1)\",\"opacity\":1,\"size\":7.55905511811024,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\"}},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.2283105022831,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":54.7945205479452},\"plot_bgcolor\":\"rgba(235,235,235,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[1.6,10.4],\"tickmode\":\"array\",\"ticktext\":[\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\"],\"tickvals\":[2,3,4,5,6,7,8,9,10],\"categoryorder\":\"array\",\"categoryarray\":[\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"k\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.118698083487013,0.144735875239071],\"tickmode\":\"array\",\"ticktext\":[\"0.120\",\"0.125\",\"0.130\",\"0.135\",\"0.140\"],\"tickvals\":[0.12,0.125,0.13,0.135,0.14],\"categoryorder\":\"array\",\"categoryarray\":[\"0.120\",\"0.125\",\"0.130\",\"0.135\",\"0.140\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"sil_width\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"36324f785bef\":{\"x\":{},\"y\":{},\"type\":\"scatter\"},\"363266dbd0ab\":{\"x\":{},\"y\":{}}},\"cur_data\":\"36324f785bef\",\"visdat\":{\"36324f785bef\":[\"function (y) \",\"x\"],\"363266dbd0ab\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\nTo identify the number of clusters with the highest average silhouette width, we perform the cluster analysis with differing numbers of clusters. In our case we choose two through to ten clusters. The reason we limited the maximum number of clusters to ten is that the larger numbers become the more difficult it becomes to interpret and ultimately act upon. As can be seen from the graph, six clusters generated the highest average silhouette width and will therefore be used in our analysis.\n\n\nIt is important to note that the average silhouette value (0.14) is actually quite low. According to anecdotal evidence, we would ideally want, at a minimum, a value between 0.25 and 0.5 (see [Kaufmann and Rousseuw, 1990](https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316801)). Our low value might be indicative of limited structure in the data, or some clusters being weaker than others (i.e., some clusters group loosely, while others group tightly). To better understand the low value we have opted to look at the practical insights generated by the clusters and to visualise the cluster structure using t-Distributed Stochastic Neighbour Embedding (t-SNE). Both of these are explained below.\n\n<br>\n\n\n# 5. Analysis: Interpreting the Clusters\nA topic we have not addressed yet, despite having already performed the clustering, is the method of cluster analysis employed. \n\nIn this analysis, we used the Partitioning Around Medoids (PAM) method. This method is identical to K-Means which is the most common form of clustering practiced. The only difference is that cluster centres for PAM are defined by the raw dataset observations, which in our example are our fifteen variables. This PAM approach has two key benefits over K-Means clustering. Firstly, it is less sensitive to outliers (e.g., such as a very high monthly income). Secondly, PAM also provides an exemplar case for each cluster, called a “Medoid”, which makes cluster interpretation easier.\n\nWith that this in mind, let’s re-run the cluster analysis with 6 clusters, as informed by our average silhouette width, join the cluster analysis results with our original dataset to identify into which cluster each individual falls, and then take a closer look at the six Medoids representing our six clusters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set the number of clusters\nk <- 6\n\n\n# rerun the cluster analysis with 6 clusters\npam_fit <- cluster::pam(gower_dist, diss = TRUE, k)\n\n\n# add the cluster assignment to each employee\nhr_subset_tbl <- hr_subset_tbl %>%\n    dplyr::mutate(cluster = pam_fit$clustering) \n\n\n# have a look at the Medoids to understand the clusters\nhr_subset_tbl[pam_fit$medoids, ] %>% \n    \n    # add the cluster column to the front\n    dplyr::relocate(cluster, everything()) %>% \n    \n    # convert to a datatable, ensuring all rows are visible\n    DT::datatable(rownames = FALSE, caption = 'Cluster Medoids',\n                options = list(\n                                columnDefs = list(list(className = 'dt-center', \n                                                       targets   = 0:16)),\n                                dom            = 't',\n                                scrollX        = TRUE,\n                                scrollCollapse = TRUE)) \n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-f58e03fd9ac6ce8f6b36\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f58e03fd9ac6ce8f6b36\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"caption\":\"<caption>Cluster Medoids<\\/caption>\",\"data\":[[1,2,3,4,5,6],[1171,35,65,221,747,1408],[\"No\",\"No\",\"Yes\",\"No\",\"No\",\"No\"],[\"No\",\"No\",\"Yes\",\"No\",\"No\",\"No\"],[2,2,1,1,2,4],[5155,6825,3441,2713,5304,16799],[6,9,2,5,8,20],[0,1,0,1,1,1],[5,2,2,2,7,9],[9,10,2,5,10,21],[\"Single\",\"Married\",\"Single\",\"Married\",\"Divorced\",\"Married\"],[42,42,28,28,30,42],[4,7,2,2,7,7],[\"Sales Executive\",\"Sales Executive\",\"Laboratory Technician\",\"Research Scientist\",\"Sales Executive\",\"Manager\"],[2,3,3,3,3,3],[3,3,3,3,3,3],[\"Travel_Rarely\",\"Travel_Rarely\",\"Travel_Rarely\",\"Travel_Rarely\",\"Travel_Rarely\",\"Travel_Rarely\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>cluster<\\/th>\\n      <th>EmployeeNumber<\\/th>\\n      <th>Attrition<\\/th>\\n      <th>OverTime<\\/th>\\n      <th>JobLevel<\\/th>\\n      <th>MonthlyIncome<\\/th>\\n      <th>YearsAtCompany<\\/th>\\n      <th>StockOptionLevel<\\/th>\\n      <th>YearsWithCurrManager<\\/th>\\n      <th>TotalWorkingYears<\\/th>\\n      <th>MaritalStatus<\\/th>\\n      <th>Age<\\/th>\\n      <th>YearsInCurrentRole<\\/th>\\n      <th>JobRole<\\/th>\\n      <th>EnvironmentSatisfaction<\\/th>\\n      <th>JobInvolvement<\\/th>\\n      <th>BusinessTravel<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-center\",\"targets\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}],\"dom\":\"t\",\"scrollX\":true,\"scrollCollapse\":true,\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n<br>\n\nThe Medoids, which are the exemplar cases (i.e., employee) for each cluster, are presented in the table above. These Medoids can be useful in the creation of Persona's if we were looking to operationlise results (discussed below).\n\nTo better understand attrition in our population we calculated the rate of attrition in each cluster, and how much each cluster captures overall attrition in our dataset.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.1/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.25/datatables.js\"></script>\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}